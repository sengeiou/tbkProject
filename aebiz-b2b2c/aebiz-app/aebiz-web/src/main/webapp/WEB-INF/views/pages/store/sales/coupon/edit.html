<!--#
layout("/layouts/store.html"){
#-->
<style>
    .rule-group-cnd,.rule-group-act{
        margin: 5px 5px 5px 15px; padding: 5px;display: none;
    }
    .rule-cnd-def ul{
        list-style-type:none
    }
    .rule-cnd-def ul li{
        padding: 5px;
    }
    .cnd-panel{
        overflow-x:auto; white-space:nowrap;
    }
    .cnd-del{
        cursor:pointer;padding: 5px;
    }

    .rule-price-input-sm{
        width: 60px;
    }
    .rule-input-sm{
        width: 50px;
    }
    .member-lvs{
        display: inline-block
    }
    .member-lv-inline {
        position: relative;
        display: inline-block;
        padding-top: 7px;
        padding-left: 1px;
        margin-bottom: 0;
        font-weight: 400;
        vertical-align: middle;
    }
    .rule-input-rate{
        width: 100px;min-width: 80px;
    }
    .rule-input-price{
        width: 120px;min-width: 100px;
    }
    .rule-input-number{
        width: 60px;min-width: 40px;
    }
</style>
<link rel="stylesheet" href="${base!}/assets/platform/vendor/layui/css/layui.css">
<header class="header navbar bg-white shadow">
    <div class="btn-group tool-button">
        <a class="btn btn-primary navbar-btn" href="${base}/store/sales/coupon" id="goBack" data-pjax><i class="ti-angle-left"></i>${msg['globals.button.back']}</a>
    </div>
    <div class="pull-right">
        <div class="btn-group tool-button">
            <!--<button class="btn btn-primary navbar-btn js-to-check" data-loading-text="${msg['globals.button.submit.tip']}" >保存并提交审核</button>-->
            <button class="btn btn-primary navbar-btn js-save" data-loading-text="${msg['globals.button.submit.tip']}" > ${msg['globals.button.save']}</button>
            <a id="doLink" href="${base}/store/sales/coupon/add" data-pjax></a>
        </div>
    </div>
</header>

<div class="content-wrap">
    <div class="wrapper" style="min-height:500px;">
        <section class="panel panel-form">
            <form id="addForm" role="form" class="form-horizontal parsley-form" data-parsley-validate action="${base}/store/sales/coupon/addDo" method="post">
                <input type="hidden" name="id" value="${obj.id!}"/>
                <div class="tab-content">
                    <!--优惠券-->
                    <div class="tab-pane fade active in" id="base">
                        <div class="row mb10 mt10">
                            <div class="col-lg-12">
                                <div class="form-group">
                                    <label for="name" class="col-sm-2 control-label">${msg['sales.coupon.column.name']}</label>
                                    <div class="col-sm-5">
                                        <input type="text" id="name" value="${obj.name!}" class="form-control" name="name" data-parsley-required="true" placeholder="${msg['sales.coupon.column.name']}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="codeprefix" class="col-sm-2 control-label">${msg['sales.coupon.column.codeprefix']}</label>
                                    <div class="col-sm-2">
                                        <input type="text" id="codeprefix" value="${obj.codeprefix!}" class="form-control" name="codeprefix" data-parsley-required="true" placeholder="${msg['sales.coupon.column.codeprefix']}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">${msg['sales.coupon.column.enabled']}</label>
                                    <div class="col-sm-1 switcha">
                                        <div class="mr15">
                                            <input type="hidden" name="disabled" value="${obj.disabled ? 1 : 0}"/>
                                            <input type="checkbox" name="enabled" class="js-switch-blue" <!--#if(!obj.disabled){#-->checked<!--#}#--> >
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label">有效期</label>
                                    <div class="col-sm-8 form-inline">
                                        <div class="layui-form">
                                            <div class="layui-form-item">
                                                <div class="layui-inline">
                                                    <div class="layui-input-inline">
                                                        <input type="text" name="tmp_sartAt" class="layui-input" id="test29" placeholder="选择日期">
                                                    </div>
                                                </div>
                                            </div>
                                            <span>至</span>
                                            <div class="layui-form-item">
                                                <div class="layui-inline">
                                                    <div class="layui-input-inline">
                                                        <input type="text" name="tmp_endAt" class="layui-input" id="test30" placeholder="选择日期">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <!--</div>-->
            </form>
        </section>
    </div>
</div>
<script src="${base!}/assets/platform/vendor/layui/layui.all.js"></script>
<script type="application/javascript">

    $(document).ready(function () {

        var form = layui.form;
        layui.use(['form', 'layedit', 'laydate'], function(){
            var laydate = layui.laydate;

            form.render();
            //直接嵌套显示
            laydate.render({
                elem: '#test29'
                ,theme: 'molv'
                ,type: 'datetime'
                ,value: '${@date.getDate(obj.startTime!)}'
                ,done: function(value, date, endDate){
                    console.log(value); //得到日期生成的值，如：2017-08-18
                    console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                    console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
                }
            });
            laydate.render({
                elem: '#test30'
                ,theme: 'molv'
                ,value: '${@date.getDate(obj.endTime!)}'
                ,type: 'datetime'
                ,done: function(value, date, endDate){
                    console.log(value); //得到日期生成的值，如：2017-08-18
                    console.log(date); //得到日期时间对象：{year: 2017, month: 8, date: 18, hours: 0, minutes: 0, seconds: 0}
                    console.log(endDate); //得结束的日期时间对象，开启范围选择（range: true）才会返回。对象成员同上。
                }
            });
        });

        //保存
        $(".js-save").click(function () {
            $('#addForm').submit();

        });

        $('#addForm').ajaxForm({
            dataType: 'json',
            beforeSubmit: function (arr, form, options) {
                form.find("button:submit").button("loading");
            },
            success: function (data, statusText, xhr, form) {
                if (data.code == 0) {
                    Toast.success(data.msg);
                    window.location.href="${base}/store/sales/coupon";
                } else {
                    Toast.error(data.msg);
                }
                form.find("button:submit").button("reset");
            }
        });



        //form表单基础效果
        myForm.init();

        $('.js-start-time').datetimepicker({
            language:  "${lang!'zh-CN'}",
            format:'yyyy-mm-dd hh:ii:ss',
            pickerPosition: 'bottom-left',
            weekStart: 1,
            todayBtn:  1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            forceParse: 0,
            showMeridian: 1,
            endDate: new Date("${@date.getDate()}")
        }).on("changeDate", function (e) {
            $('.js-end-time').datetimepicker('setStartDate', e.date);
        });

        $('.js-end-time').datetimepicker({
            language:  "${lang!'zh-CN'}",
            format:'yyyy-mm-dd hh:ii:ss',
            pickerPosition: 'bottom-left',
            weekStart: 1,
            todayBtn:  1,
            autoclose: 1,
            todayHighlight: 1,
            startView: 2,
            forceParse: 0,
            showMeridian: 1,
            startDate: new Date("${@date.getDate()}")
        }).on("changeDate", function (e) {
            $('.js-start-time').datetimepicker('setEndDate', e.date);
        });

    })

    $(".radioType").change(function () {
        var val = $(this).val();
        if(val == 1){ //满减
            $("#deductibleAmountFor").css("display","block");
            $("#conditionAmountFor").css("display","block");
            $("#productQuantityRuleFor").css("display","none");
            $("#discountFor").css("display","none");
        }
        if(val == 2){ //免运
            $("#deductibleAmountFor").css("display","none");
            $("#conditionAmountFor").css("display","none");
            $("#productQuantityRuleFor").css("display","block");
            $("#discountFor").css("display","none");
        }
        if(val == 3){ //折扣
            $("#deductibleAmountFor").css("display","none");
            $("#conditionAmountFor").css("display","none");
            $("#productQuantityRuleFor").css("display","block");
            $("#discountFor").css("display","block");
        }
    })

    //禁用启用颠倒了
    $("[name='enabled']").change(function () {
        if (this.checked) {
            $("[name='disabled']:hidden").val(0);
        } else {
            $("[name='disabled']:hidden").val(1);
        }
    });





</script>


<!--#}#-->


