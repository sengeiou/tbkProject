<!doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">


	<style type="text/css">

		.mb_0{margin-bottom:0;}
		.tab-content .p_nopadding,.p_nopadding{padding-left:0;padding-right:0;}
		.p_left{float:left;padding:0 10px;line-height:34px;}
		.p_right{float:right;}
		.p_background{background:#f1f1f1;overflow:hidden;padding:15px 0;}
		.p_btn{display:inline-block;background:#2D2D2D;line-height:34px;padding:0 15px;color:#fff;}
		.p_bj_bt{padding-top:20px;}
		.p_bj_bt b{color:#e51400;font-weight:lighter;}
		.p_bj_bt li.active b{color:#fff;}

		.module-con .p_bj_list{background:#fff;overflow:hidden;margin-bottom:-15px;padding:0;clear:both;}
		.p_bj_list dl{width:100%;overflow:hidden;padding:10px 2%;border-bottom:1px solid #ddd}
		.p_bj_list dl:hover{background:#fffecf;}
		.p_bj_list dt{width:50px;height:50px;float:left;margin-right:15px;}
		.p_bj_list dt img{width:50px;height:50px;}
		.p_bj_list dd{float:left;width:70%;line-height:22px;padding-top:5px;}
		.p_bj_list dd p{height:22px;overflow:hidden;}
		.p_bj_list dd.operation{float:right;width:20%;}
		.p_bj_list dd.operation a,.p_bj_list dd.operation span{margin-right:10px;}

	</style>
</head>
<body>



<form class="form-horizontal">

	<div class="form-group">
		<label for="loginname" class="col-sm-3 control-label">是否异步加载</label>
		<div class="col-sm-3">
			是 <input type="radio" name="needAsyncInit" value="true"
					 placeholder="" checked="checked"> 否 <input type="radio"
																name="needAsyncInit" value="false" placeholder="">
		</div>
	</div>



	<div class="form-group">
		<label for="loginname" class="col-sm-3 control-label">标签名称</label>
		<div class="col-sm-3">
			<input type="text" class="form-control" name="lableName" id="lableName" placeholder="标签名"/>

		</div>
	</div>



	<div class="form-group">
		<label for="loginname" class="col-sm-3 control-label">发布主题</label>
		<div class="col-sm-3">
			<input type="text" id="topic" class="form-control"
				   name="topic" placeholder="主题">

		</div>
	</div>


	<div class="form-group">
		<label class="col-sm-3 control-label">我的商品收藏地址</label>
		<div class="col-sm-3">
			<input type="text" id="collectProductUrl" class="form-control"
				   name="collectProductUrl" value="/usercenter/productfavorite/toPage">

		</div>
	</div>




	<div class="form-group">


		<label for="loginname" class="col-sm-3 control-label">图片分类</label>

		<div class="col-sm-3">

			<select id="categoryUuid" name="categoryUuid" class="form-control p_nopadding mr_10">
				<option value="">所有分类</option>
				<!--# for(cid in list){
#-->
				<option value="${cid.categoryUuid}">${cid.categoryName}</option>
				<!--#
                }#-->
			</select>


		</div>

		<button type="button" class="btn btn-primary"
				onclick="javascript:showSearch('1','5')">查询</button>
	</div>






	<input type="hidden" id="imgSrc" name="imgSrc">
	<input type="hidden" id="imgUuid" name="imgUuid" value="${imgUuid!}">



</form>


<div class="tab-content p_nopadding">

	<div class="col-sm-6">
		<ul class="nav nav-tabs">
			<li class="active"><a href="#p_list" data-toggle="tab">${inproductuuids!}全部</a></li>
			<li><a href="#p_list2" data-toggle="tab">图标（<b
					id="recommendNum">未选</b>）
			</a></li>
		</ul>
	</div>



	<div class="tab-pane active" id="p_list">

		<div class="tab-content p_bj_list ">


			<div id="productPage"></div>

			<div id="pagelayui"></div>

		</div>
	</div>

	<div class="tab-pane p_bj_list" id="p_list2">

		<div class="tab-content p_bj_list ">


			<div id="haveTake">



			</div>
		</div>



	</div>


</div>











<div id="imageHtml" style="display: none;">


	<dl id="2edc9c5c40d44ed3b893a0e87dc71995222">
		<dt>
			<a href="#"><img height="40" width="40"
							 src="http://www.tclo2o.cn/dev1/0/000/001/0000001643.fid"></a>
		</dt>
		<dd>
			<p>
				<span>TCL XQB50-1678NS 5公斤 全自动波轮洗衣机 模式可调（浅灰色）</span>
			</p>
		</dd>
		<dd class="operation">
			<a
					href="javascript:recommend('2edc9c5c40d44ed3b893a0e87dc71995222')">推荐</a>

		</dd>
	</dl>


</div>


</body>








<script type="text/javascript">
    var pageJson = ${webPageModelJsonStr};

    var componentsParam = {
        initParamData : function(pageJson) {
            if (typeof (pageJson) == "string") {
                pageJson = JSON.parse(pageJson);
            }

            if (pageJson.needAsyncInit) {
                $("input[name='needAsyncInit'][value=" + pageJson.needAsyncInit + "]")
                    .attr("checked", true);					}

            if (pageJson.imgSrc) {
                $("#imgSrc").val(pageJson.imgSrc);
            }
            if (pageJson.categoryUuid) {
                $("#categoryUuid").find("option[value='"+pageJson.categoryUuid+"']").attr("selected",true);
            }

            if (pageJson.lableName) {
                $("#lableName").val(pageJson.lableName);
            }
            if (pageJson.topic) {
                $("#topic").val(pageJson.topic);
            }
            if (pageJson.collectProductUrl) {
                $("#collectProductUrl").val(pageJson.collectProductUrl);
            }
            if (pageJson.imgUuid) {
                $("#imgUuid").val(pageJson.imgUuid);
            }


            if (pageJson.haveTakeHtml) {

                var html=unescape(pageJson.haveTakeHtml);


                $("#recommendNum").html("<font color='red'>已选</font>");


                $("#haveTake").html(html);
            }

        },
        saveParamData : function() {
            var needAsyncInit = $("input[name='needAsyncInit']:checked").val();
            var imgSrc = $("#imgSrc").val();
            var lableName = $("#lableName").val();
            var topic = $("#topic").val();
            var imgUuid = $("#imgUuid").val();

            var haveTakeHtml=$("#haveTake").html();
            var collectProductUrl=$("#collectProductUrl").val();
            var categoryUuid = $("#categoryUuid option:selected").val();
            haveTakeHtml = escape(haveTakeHtml);



            var pageJson = {
                compId : 'collectionproduct',
                "needAsyncInit" : needAsyncInit,
                "lableName" : lableName,
                "imgSrc" : imgSrc,
                "haveTakeHtml":haveTakeHtml,
                "categoryUuid":categoryUuid,
                "topic":topic,
                "collectProductUrl":collectProductUrl,
                "imgUuid":imgUuid
            };
            return pageJson;
        },

        showParamData:function(){

            console.log($("#lableName").val())
            var paramData = [];
            var labelName = {
                type:'text',
                target:'collectionproduct_span',
                value:$("#lableName").val()
            }
            var srcImage = {
                type:'src',
                target:'collectionproduct_img',
                value:$("#imgSrc").val()
            }

            paramData.push(labelName);
            paramData.push(srcImage);

            return paramData;
        }


    }

    componentsParam.initParamData(pageJson);
</script>









<script type="text/javascript">

    function cancelRecommend(uuid,imgSrc){


        console.log(uuid);

        $("#haveTake").html(" ");

        $("#imgSrc").val("");

        console.log(uuid);



        $("#"+uuid).find("a").eq(1).text("选为图标");


        $("#"+uuid).find("a").eq(1).attr("href","javascript:recommend('" +uuid + "','"
            + imgSrc + "')");

        $("#recommendNum").html("未选");

    }
    function recommend(uuid, imgSrc) {



        $("#imgSrc").val(imgSrc);
        $("#imgUuid").val(uuid);

        $("#haveTake").html(" ");

        var dlhtml = $("#" + uuid).clone();

        dlhtml.attr("id", uuid + uuid)

        dlhtml.find("a").last().text("取消推荐");
        dlhtml.find("a").last().attr("href",
            "javascript:cancelRecommend('" + uuid + "')")

        $("#haveTake").append(dlhtml);


        $("#recommendNum").html("<font color='red'>已选</font>");






        $("#productPage").find("dl").each(function(){


            if(uuid==$(this).attr("id")){

                $(this).find("a").eq(1).text("取消图标");

                $(this).find("a").eq(1).attr("href",
                    "javascript:cancelRecommend('" + uuid + "','"+imgSrc+"')")
            }
            else {
                $(this).find("a").eq(1).text("选为图标");

            }

        })






    }

    function loadData(totalNum, pageShow) {

        console.log(totalNum + "totalNum11");

        layui.use([ 'laypage', 'layer' ], function() {
            var laypage = layui.laypage, layer = layui.layer;
            var pages = Math.ceil(totalNum / pageShow);
            if (pages < 1) {
                pages = 1;
            }

            var uri = window.location.href;
            var reg = new RegExp("(^|&)nowPage=([^&]*)");
            var r = uri.match(reg);
            if (!$.isEmptyObject(r)) {
                var curr = r[2];
            }


            laypage({
                cont : $("#pagelayui"),
                pages : pages //总页数
                ,
                groups : 5 //连续显示分页数
                ,
                curr : curr,
                jump : function(obj, first) {

                    if (!first) {

                        //点击下一页的时候不需要从新计算totalNum
                        showSearch2(obj.curr, "5");

                    }

                }
            });
        })
    }

    //列表展示
    function showSearch(nowPage, pageShow) {

        $("#pageShow").val(pageShow);
        $("#nowPage").val(nowPage);

        var categoryUuid = $("select[name='categoryUuid']").val();

        var uuid= $("#uuid").val();
        var imgUuid= $("#imgUuid").val();

        var data = {
            "nowPage" : nowPage,
            "pageShow" : pageShow,
            "categoryUuid" : categoryUuid,
            "uuid":uuid
        };

        $.ajax({
            type : "GET",
            url : ContextPath+"/pictureAdComp/getPageData",
            data : data,
            dataType : "json",
            async : false,
            success : function(data) {
                data=eval("("+data+")");
                var totalNum = data.totalNum;


                var pageShow = "5";

                loadData(totalNum, pageShow);

                $("#productPage").html("");

                $.each(data.rows, function(index, colum) {

                    var oneHtml = $("#imageHtml").children().clone();

                    oneHtml.attr("id", colum.imgUuid);

                    oneHtml.find("img").attr("src", colum.imgSrc);

                    if(imgUuid==colum.imgUuid){


                        oneHtml.find("a").eq(1).text("取消选择");

                        oneHtml.find("a").eq(1).attr(
                            "href",
                            "javascript:cancelRecommend('" + colum.imgUuid + "','"
                            + colum.imgSrc + "')");

                    }
                    else {

                        oneHtml.find("a").eq(1).text("选为图标");

                        oneHtml.find("a").eq(1).attr(
                            "href",
                            "javascript:recommend('" + colum.imgUuid + "','"
                            + colum.imgSrc + "')");
                    }



                    $("#productPage").append(oneHtml[0].outerHTML);

                })

            }

        })

    }

    function showSearch2(nowPage, pageShow) {

        var imgUuid =$("#imgUuid").val();

        console.log(imgUuid);

        $("#pageShow").val(pageShow);
        $("#nowPage").val(nowPage);

        var categoryUuid = $("select[name='categoryUuid']").val();

        var data = {
            "nowPage" : nowPage,
            "pageShow" : pageShow,
            "categoryUuid" : categoryUuid
        };

        $.ajax({
            type : "GET",
            url : ContextPath+"/pictureAdComp/getPageData",
            data : data,
            dataType : "json",
            async : false,
            success : function(data) {
                data=eval("("+data+")");
                var totalNum = data.totalNum;

                var pageShow = "5";
                $("#productPage").html("");

                $.each(data.rows, function(index, colum) {

                    var oneHtml = $("#imageHtml").children().clone();
                    oneHtml.attr("id", colum.imgUuid);

                    oneHtml.attr("id", colum.productUuid);

                    oneHtml.find("img").attr("src", colum.imgSrc);




                    oneHtml.find("a").eq(1).text("选为图标");

                    oneHtml.find("a").eq(1).attr(
                        "href",
                        "javascript:recommend('" + colum.imgUuid + "','"
                        + colum.imgSrc + "')");



                    $("#productPage").append(oneHtml[0].outerHTML);

                    if(imgUuid==colum.imgUuid){



                        $("#"+imgUuid).find("a").eq(1).text("取消选择");

                        $("#"+imgUuid).find("a").eq(1).attr(
                            "href",
                            "javascript:cancelRecommend('" + colum.imgUuid + "','"
                            + colum.imgSrc + "')");

                    }



                })

            }

        })

    }

    $(function() {

        showSearch("1", "5");

    })
</script>


</html>
